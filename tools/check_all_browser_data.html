<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Åô„Åπ„Å¶„ÅÆ„Éñ„É©„Ç¶„Ç∂„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        button { padding: 10px 20px; margin: 5px; cursor: pointer; background: #007bff; color: white; border: none; border-radius: 5px; }
        button:hover { background: #0056b3; }
        .data-display { background: #f5f5f5; padding: 10px; margin: 10px 0; border-radius: 5px; max-height: 400px; overflow-y: auto; }
        .success { color: green; font-weight: bold; }
        .error { color: red; }
        .warning { color: orange; }
        pre { white-space: pre-wrap; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>üîç „Åô„Åπ„Å¶„ÅÆ„Éñ„É©„Ç¶„Ç∂‰øùÂ≠ò„Éá„Éº„Çø„ÇíÁ¢∫Ë™ç</h1>

    <div class="section">
        <h2>„É≠„Éº„Ç´„É´„Çπ„Éà„É¨„Éº„Ç∏„ÅÆ„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø</h2>
        <button onclick="checkAllLocalStorage()">„Åô„Åπ„Å¶Ë°®Á§∫</button>
        <button onclick="exportAllData()">„Åô„Åπ„Å¶„Ç®„ÇØ„Çπ„Éù„Éº„Éà</button>
        <div id="localStorageDisplay"></div>
    </div>

    <div class="section">
        <h2>„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏„ÅÆ„Éá„Éº„Çø</h2>
        <button onclick="checkSessionStorage()">Á¢∫Ë™ç</button>
        <div id="sessionStorageDisplay"></div>
    </div>

    <div class="section">
        <h2>IndexedDB„ÅÆ„Éá„Éº„Çø</h2>
        <button onclick="checkIndexedDB()">Á¢∫Ë™ç</button>
        <div id="indexedDBDisplay"></div>
    </div>

    <script>
        function checkAllLocalStorage() {
            const display = document.getElementById('localStorageDisplay');
            let html = '<h3>‰øùÂ≠ò„Åï„Çå„Å¶„ÅÑ„Çã„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø:</h3>';

            if (localStorage.length === 0) {
                html += '<p class="warning">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            } else {
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    const value = localStorage.getItem(key);

                    html += `<div class="data-display">`;
                    html += `<p class="success">„Ç≠„Éº: ${key}</p>`;

                    try {
                        const parsed = JSON.parse(value);

                        // Êó•‰ªò„Éá„Éº„Çø„ÇíÊé¢„Åô
                        let dateInfo = '';
                        if (typeof parsed === 'object') {
                            // „Ç™„Éñ„Ç∏„Çß„ÇØ„Éà„ÅÆ‰∏≠„Åã„ÇâÊó•‰ªò„Çâ„Åó„Åç„Ç≠„Éº„ÇíÊé¢„Åô
                            for (let objKey in parsed) {
                                if (objKey.includes('2024') || objKey.includes('Âπ¥') || objKey.includes('Êúà') || objKey.includes('Êó•')) {
                                    dateInfo += `Êó•‰ªò„Ç≠„ÉºÁô∫Ë¶ã: ${objKey}\n`;
                                }
                            }
                        }

                        html += `<pre>${dateInfo}\n${JSON.stringify(parsed, null, 2).substring(0, 1000)}</pre>`;

                        // „Éá„Éº„Çø„ÅÆ„Çµ„Ç§„Ç∫„Å®È†ÖÁõÆÊï∞
                        const size = new Blob([value]).size;
                        const itemCount = typeof parsed === 'object' ? Object.keys(parsed).length : 0;
                        html += `<p>„Çµ„Ç§„Ç∫: ${size}„Éê„Ç§„Éà | È†ÖÁõÆÊï∞: ${itemCount}</p>`;

                    } catch (e) {
                        // JSON‰ª•Â§ñ„ÅÆ„Éá„Éº„Çø
                        html += `<pre>${value.substring(0, 500)}</pre>`;
                    }
                    html += '</div>';
                }
            }

            display.innerHTML = html;
        }

        function checkSessionStorage() {
            const display = document.getElementById('sessionStorageDisplay');
            let html = '<h3>„Çª„ÉÉ„Ç∑„Éß„É≥„Çπ„Éà„É¨„Éº„Ç∏:</h3>';

            if (sessionStorage.length === 0) {
                html += '<p class="warning">„Éá„Éº„Çø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
            } else {
                for (let i = 0; i < sessionStorage.length; i++) {
                    const key = sessionStorage.key(i);
                    const value = sessionStorage.getItem(key);
                    html += `<div class="data-display">`;
                    html += `<p class="success">„Ç≠„Éº: ${key}</p>`;
                    html += `<pre>${value.substring(0, 500)}</pre>`;
                    html += '</div>';
                }
            }

            display.innerHTML = html;
        }

        async function checkIndexedDB() {
            const display = document.getElementById('indexedDBDisplay');
            let html = '<h3>IndexedDB:</h3>';

            try {
                const databases = await indexedDB.databases();
                if (databases.length === 0) {
                    html += '<p class="warning">„Éá„Éº„Çø„Éô„Éº„Çπ„Åå„ÅÇ„Çä„Åæ„Åõ„Çì</p>';
                } else {
                    for (const db of databases) {
                        html += `<p class="success">„Éá„Éº„Çø„Éô„Éº„Çπ: ${db.name} („Éê„Éº„Ç∏„Éß„É≥: ${db.version})</p>`;
                    }
                }
            } catch (e) {
                html += '<p class="error">IndexedDB„Å´„Ç¢„ÇØ„Çª„Çπ„Åß„Åç„Åæ„Åõ„Çì</p>';
            }

            display.innerHTML = html;
        }

        function exportAllData() {
            const allData = {
                exportDate: new Date().toISOString(),
                localStorage: {},
                sessionStorage: {}
            };

            // LocalStorage
            for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                const value = localStorage.getItem(key);
                try {
                    allData.localStorage[key] = JSON.parse(value);
                } catch (e) {
                    allData.localStorage[key] = value;
                }
            }

            // SessionStorage
            for (let i = 0; i < sessionStorage.length; i++) {
                const key = sessionStorage.key(i);
                const value = sessionStorage.getItem(key);
                try {
                    allData.sessionStorage[key] = JSON.parse(value);
                } catch (e) {
                    allData.sessionStorage[key] = value;
                }
            }

            // „ÉÄ„Ç¶„É≥„É≠„Éº„Éâ
            const blob = new Blob([JSON.stringify(allData, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ÂÖ®„Éñ„É©„Ç¶„Ç∂„Éá„Éº„Çø_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);

            alert('„Åô„Åπ„Å¶„ÅÆ„Éá„Éº„Çø„Çí„Ç®„ÇØ„Çπ„Éù„Éº„Éà„Åó„Åæ„Åó„ÅüÔºÅ');
        }
    </script>
</body>
</html>